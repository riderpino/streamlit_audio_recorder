{"version":3,"sources":["../src/assets.ts","../src/vmsg.ts","../src/multi-recorder.ts"],"names":["fadeTime","delayTime"],"mappings":"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","file":"index.js","sourcesContent":["/**\r\n * Get the URL for the vmsg.wasm file\r\n * This can be used with Vite's ?url import or as a fallback path\r\n */\r\nexport const VMSG_WASM_URL = \"/vmsg.wasm\";\r\n\r\n/**\r\n * Get the URL for the PCM worklet file\r\n * This can be used with Vite's ?url import or as a fallback path\r\n * \r\n * Usage with Vite:\r\n * ```ts\r\n * import pcmWorklet from \"react-ts-audio-recorder/assets/pcm-worklet.js?url\";\r\n * ```\r\n * \r\n * Or use the constant:\r\n * ```ts\r\n * import { PCM_WORKLET_URL } from \"react-ts-audio-recorder\";\r\n * ```\r\n */\r\nexport const PCM_WORKLET_URL = \"/pcm-worklet.js\";\r\n\r\n/**\r\n * Default WASM URL for vmsg encoder\r\n * Can be overridden in MultiRecorderOptions\r\n * \r\n * Usage with Vite:\r\n * ```ts\r\n * import vmsgWasm from \"react-ts-audio-recorder/assets/vmsg.wasm?url\";\r\n * ```\r\n * \r\n * Or use the constant:\r\n * ```ts\r\n * import { DEFAULT_VMSG_WASM_URL } from \"react-ts-audio-recorder\";\r\n * ```\r\n */\r\nexport const DEFAULT_VMSG_WASM_URL = VMSG_WASM_URL;\r\n\r\n/**\r\n * Load PCM worklet into AudioContext\r\n * \r\n * @param audioContext - The AudioContext to add the worklet to\r\n * @param workletURL - Optional worklet URL. If not provided, uses PCM_WORKLET_URL\r\n * @returns Promise that resolves when worklet is loaded\r\n * \r\n * @example\r\n * ```ts\r\n * import { loadPCMWorklet } from \"react-ts-audio-recorder\";\r\n * import pcmWorklet from \"react-ts-audio-recorder/assets/pcm-worklet.js?url\";\r\n * \r\n * const audioContext = new AudioContext();\r\n * await loadPCMWorklet(audioContext, pcmWorklet);\r\n * const processor = new AudioWorkletNode(audioContext, \"pcm-processor\");\r\n * ```\r\n */\r\nexport async function loadPCMWorklet(\r\n  audioContext: AudioContext,\r\n  workletURL?: string\r\n): Promise<void> {\r\n  const url = workletURL || PCM_WORKLET_URL;\r\n  await audioContext.audioWorklet.addModule(url);\r\n}\r\n\r\n","/* eslint-disable */\n// @ts-nocheck\n\nfunction pad2(n) {\n  n |= 0;\n  return n < 10 ? `0${n}` : `${Math.min(n, 99)}`;\n}\n\nfunction inlineWorker() {\n  function fetchAndInstantiate(url, imports) {\n    if (!WebAssembly.instantiateStreaming) return fetchAndInstantiateFallback(url, imports);\n    const req = fetch(url, { credentials: \"same-origin\" });\n    return WebAssembly.instantiateStreaming(req, imports).catch(err => {\n      if (err.message && err.message.indexOf(\"Argument 0 must be provided and must be a Response\") > 0) {\n        return fetchAndInstantiateFallback(url, imports);\n      } else {\n        throw err;\n      }\n    });\n  }\n\n  function fetchAndInstantiateFallback(url, imports) {\n    return new Promise((resolve, reject) => {\n      const req = new XMLHttpRequest();\n      req.open(\"GET\", url);\n      req.responseType = \"arraybuffer\";\n      req.onload = () => {\n        resolve(WebAssembly.instantiate(req.response, imports));\n      };\n      req.onerror = reject;\n      req.send();\n    });\n  }\n\n  // Must be in sync with emcc settings!\n  const TOTAL_STACK = 5 * 1024 * 1024;\n  const TOTAL_MEMORY = 16 * 1024 * 1024;\n  const WASM_PAGE_SIZE = 64 * 1024;\n  let memory = null;\n  let dynamicTop = TOTAL_STACK;\n  // TODO(Kagami): Grow memory?\n  function sbrk(increment) {\n    const oldDynamicTop = dynamicTop;\n    dynamicTop += increment;\n    return oldDynamicTop;\n  }\n  // TODO(Kagami): LAME calls exit(-1) on internal error. Would be nice\n  // to provide custom DEBUGF/ERRORF for easier debugging. Currenty\n  // those functions do nothing.\n  function exit(status) {\n    postMessage({type: \"internal-error\", data: status});\n  }\n\n  let FFI = null;\n  let ref = null;\n  let pcm_l = null;\n  function vmsg_init(rate) {\n    ref = FFI.vmsg_init(rate);\n    if (!ref) return false;\n    const pcm_l_ref = new Uint32Array(memory.buffer, ref, 1)[0];\n    pcm_l = new Float32Array(memory.buffer, pcm_l_ref);\n    return true;\n  }\n  function vmsg_encode(data) {\n    pcm_l.set(data);\n    return FFI.vmsg_encode(ref, data.length) >= 0;\n  }\n  function vmsg_flush() {\n    if (FFI.vmsg_flush(ref) < 0) return null;\n    const mp3_ref = new Uint32Array(memory.buffer, ref + 4, 1)[0];\n    const size = new Uint32Array(memory.buffer, ref + 8, 1)[0];\n    const mp3 = new Uint8Array(memory.buffer, mp3_ref, size);\n    const blob = new Blob([mp3], {type: \"audio/mpeg\"});\n    FFI.vmsg_free(ref);\n    ref = null;\n    pcm_l = null;\n    return blob;\n  }\n\n  // https://github.com/brion/min-wasm-fail\n  function testSafariWebAssemblyBug() {\n    const bin = new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]);\n    const mod = new WebAssembly.Module(bin);\n    const inst = new WebAssembly.Instance(mod, {});\n    // test storing to and loading from a non-zero location via a parameter.\n    // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n    return (inst.exports.test(4) !== 0);\n  }\n\n  onmessage = (e) => {\n    const msg = e.data;\n    switch (msg.type) {\n    case \"init\":\n      const { wasmURL, shimURL } = msg.data;\n      Promise.resolve().then(() => {\n        if (self.WebAssembly && !testSafariWebAssemblyBug()) {\n          delete self.WebAssembly;\n        }\n        if (!self.WebAssembly && shimURL) {\n          importScripts(shimURL);\n        }\n        memory = new WebAssembly.Memory({\n          initial: TOTAL_MEMORY / WASM_PAGE_SIZE,\n          maximum: TOTAL_MEMORY / WASM_PAGE_SIZE,\n        });\n        return {\n          memory: memory,\n          pow: Math.pow,\n          exit: exit,\n          powf: Math.pow,\n          exp: Math.exp,\n          sqrtf: Math.sqrt,\n          cos: Math.cos,\n          log: Math.log,\n          sin: Math.sin,\n          sbrk: sbrk,\n        };\n      }).then(Runtime => {\n        return fetchAndInstantiate(wasmURL, {env: Runtime})\n      }).then(wasm => {\n        FFI = wasm.instance.exports;\n        postMessage({type: \"init\", data: null});\n      }).catch(err => {\n        postMessage({type: \"init-error\", data: err.toString()});\n      });\n      break;\n    case \"start\":\n      if (!vmsg_init(msg.data)) return postMessage({type: \"error\", data: \"vmsg_init\"});\n      break;\n    case \"data\":\n      if (!vmsg_encode(msg.data)) return postMessage({type: \"error\", data: \"vmsg_encode\"});\n      break;\n    case \"stop\":\n      const blob = vmsg_flush();\n      if (!blob) return postMessage({type: \"error\", data: \"vmsg_flush\"});\n      postMessage({type: \"stop\", data: blob});\n      break;\n    }\n  };\n}\n\n// Internal class - used by MultiRecorder, not part of public API\nexport class Recorder {\n  constructor(opts = {}, onStop = null) {\n    // Can't use relative URL in blob worker, see:\n    // https://stackoverflow.com/a/22582695\n    const base = typeof location !== \"undefined\" ? location.href : \"http://localhost\";\n    this.wasmURL = new URL(opts.wasmURL || \"/static/js/vmsg.wasm\", base).href;\n    this.shimURL = opts.shimURL ? new URL(opts.shimURL, base).href : null;\n    this.onStop = onStop;\n    this.pitch = opts.pitch || 0;\n    this.stream = null;\n    this.audioCtx = null;\n    this.gainNode = null;\n    this.pitchFX = null;\n    this.encNode = null;\n    this.worker = null;\n    this.workerURL = null;\n    this.blob = null;\n    this.blobURL = null;\n    this.resolve = null;\n    this.reject = null;\n    Object.seal(this);\n  }\n\n  close() {\n    if (this.encNode) this.encNode.disconnect();\n    if (this.encNode) this.encNode.onaudioprocess = null;\n    if (this.stream) this.stopTracks();\n    if (this.audioCtx) this.audioCtx.close();\n    if (this.worker) {\n      this.worker.terminate();\n      this.worker = null;\n    }\n    if (this.workerURL) URL.revokeObjectURL(this.workerURL);\n    if (this.blobURL) URL.revokeObjectURL(this.blobURL);\n  }\n\n  // Without pitch shift:\n  //   [sourceNode] -> [gainNode] -> [encNode] -> [audioCtx.destination]\n  //                                     |\n  //                                     -> [worker]\n  // With pitch shift:\n  //   [sourceNode] -> [gainNode] -> [pitchFX] -> [encNode] -> [audioCtx.destination]\n  //                                                  |\n  //                                                  -> [worker]\n  initAudio() {\n    const getUserMedia = navigator.mediaDevices && navigator.mediaDevices.getUserMedia\n      ? function(constraints) {\n          return navigator.mediaDevices.getUserMedia(constraints);\n        }\n      : function(constraints) {\n          const oldGetUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n          if (!oldGetUserMedia) {\n            return Promise.reject(new Error(\"getUserMedia is not implemented in this browser\"));\n          }\n          return new Promise(function(resolve, reject) {\n            oldGetUserMedia.call(navigator, constraints, resolve, reject);\n          });\n        };\n\n    return getUserMedia({audio: true}).then((stream) => {\n      this.stream = stream;\n      const audioCtx = this.audioCtx = new (window.AudioContext\n        || window.webkitAudioContext)();\n\n      const sourceNode = audioCtx.createMediaStreamSource(stream);\n      const gainNode = this.gainNode = (audioCtx.createGain\n        || audioCtx.createGainNode).call(audioCtx);\n      gainNode.gain.value = 1;\n      sourceNode.connect(gainNode);\n\n      const pitchFX = this.pitchFX = new Jungle(audioCtx);\n      pitchFX.setPitchOffset(this.pitch);\n\n      const encNode = this.encNode = (audioCtx.createScriptProcessor\n        || audioCtx.createJavaScriptNode).call(audioCtx, 0, 1, 1);\n      pitchFX.output.connect(encNode);\n\n      gainNode.connect(this.pitch === 0 ? encNode : pitchFX.input);\n    });\n  }\n\n  initWorker() {\n    if (this.worker) return Promise.resolve();\n    // https://stackoverflow.com/a/19201292\n    const blob = new Blob(\n      [\"(\", inlineWorker.toString(), \")()\"],\n      {type: \"application/javascript\"});\n    const workerURL = this.workerURL = URL.createObjectURL(blob);\n    const worker = this.worker = new Worker(workerURL);\n    const { wasmURL, shimURL } = this;\n    worker.postMessage({type: \"init\", data: {wasmURL, shimURL}});\n    return new Promise((resolve, reject) => {\n      worker.onmessage = (e) => {\n        const msg = e.data;\n        switch (msg.type) {\n        case \"init\":\n          resolve();\n          break;\n        case \"init-error\":\n          this.close();\n          reject(new Error(msg.data));\n          break;\n        // TODO(Kagami): Error handling.\n        case \"error\":\n        case \"internal-error\":\n          this.close();\n          console.error(\"Worker error:\", msg.data);\n          if (this.reject) this.reject(msg.data);\n          break;\n        case \"stop\":\n          this.blob = msg.data;\n          this.blobURL = URL.createObjectURL(msg.data);\n          if (this.onStop) this.onStop();\n          if (this.resolve) this.resolve(this.blob);\n          break;\n        }\n      }\n    });\n  }\n\n  init() {\n    return this.initAudio().then(this.initWorker.bind(this));\n  }\n\n  startRecording() {\n    if (!this.stream) throw new Error(\"missing audio initialization\");\n    if (!this.worker) throw new Error(\"missing worker initialization\");\n    this.blob = null;\n    if (this.blobURL) URL.revokeObjectURL(this.blobURL);\n    this.blobURL = null;\n    this.resolve = null;\n    this.reject = null;\n    this.worker.postMessage({type: \"start\", data: this.audioCtx.sampleRate});\n    this.encNode.onaudioprocess = (e) => {\n      const samples = e.inputBuffer.getChannelData(0);\n      this.worker.postMessage({type: \"data\", data: samples});\n    };\n    this.encNode.connect(this.audioCtx.destination);\n  }\n\n  stopRecording() {\n    if (!this.stream) throw new Error(\"missing audio initialization\");\n    if (!this.worker) throw new Error(\"missing worker initialization\");\n    this.encNode.disconnect();\n    this.encNode.onaudioprocess = null;\n    this.stopTracks();\n    this.audioCtx.close();\n    this.worker.postMessage({type: \"stop\", data: null});\n    return new Promise((resolve, reject) => {\n      this.resolve = resolve;\n      this.reject = reject;\n    });\n  }\n\n  stopTracks() {\n    // Might be missed in Safari and old FF/Chrome per MDN.\n    if (this.stream.getTracks) {\n      // Hide browser's recording indicator.\n      this.stream.getTracks().forEach((track) => track.stop());\n    }\n  }\n}\n\nclass Form {\n  constructor(opts = {}, resolve, reject) {\n    this.recorder = new Recorder(opts, this.onStop.bind(this));\n    this.resolve = resolve;\n    this.reject = reject;\n    this.backdrop = null;\n    this.popup = null;\n    this.recordBtn = null;\n    this.stopBtn = null;\n    this.timer = null;\n    this.audio = null;\n    this.saveBtn = null;\n    this.tid = 0;\n    this.start = 0;\n    Object.seal(this);\n\n    this.recorder.initAudio()\n      .then(() => this.drawInit())\n      .then(() => this.recorder.initWorker())\n      .then(() => this.drawAll())\n      .catch((err) => this.drawError(err));\n  }\n\n  drawInit() {\n    if (this.backdrop) return;\n    const backdrop = this.backdrop = document.createElement(\"div\");\n    backdrop.className = \"vmsg-backdrop\";\n    backdrop.addEventListener(\"click\", () => this.close(null));\n\n    const popup = this.popup = document.createElement(\"div\");\n    popup.className = \"vmsg-popup\";\n    popup.addEventListener(\"click\", (e) => e.stopPropagation());\n\n    const progress = document.createElement(\"div\");\n    progress.className = \"vmsg-progress\";\n    for (let i = 0; i < 3; i++) {\n      const progressDot = document.createElement(\"div\");\n      progressDot.className = \"vmsg-progress-dot\";\n      progress.appendChild(progressDot);\n    }\n    popup.appendChild(progress);\n\n    backdrop.appendChild(popup);\n    document.body.appendChild(backdrop);\n  }\n\n  drawTime(msecs) {\n    const secs = Math.round(msecs / 1000);\n    this.timer.textContent = pad2(secs / 60) + \":\" + pad2(secs % 60);\n  }\n\n  drawAll() {\n    this.drawInit();\n    this.clearAll();\n\n    const recordRow = document.createElement(\"div\");\n    recordRow.className = \"vmsg-record-row\";\n    this.popup.appendChild(recordRow);\n\n    const recordBtn = this.recordBtn = document.createElement(\"button\");\n    recordBtn.className = \"vmsg-button vmsg-record-button\";\n    recordBtn.textContent = \"●\";\n    recordBtn.title = \"Start Recording\";\n    recordBtn.addEventListener(\"click\", () => this.startRecording());\n    recordRow.appendChild(recordBtn);\n\n    const stopBtn = this.stopBtn = document.createElement(\"button\");\n    stopBtn.className = \"vmsg-button vmsg-stop-button\";\n    stopBtn.style.display = \"none\";\n    stopBtn.textContent = \"■\";\n    stopBtn.title = \"Stop Recording\";\n    stopBtn.addEventListener(\"click\", () => this.stopRecording());\n    recordRow.appendChild(stopBtn);\n\n    const audio = this.audio = new Audio();\n    audio.autoplay = true;\n\n    const timer = this.timer = document.createElement(\"span\");\n    timer.className = \"vmsg-timer\";\n    timer.title = \"Preview Recording\";\n    timer.addEventListener(\"click\", () => {\n      if (audio.paused) {\n        if (this.recorder.blobURL) {\n          audio.src = this.recorder.blobURL;\n        }\n      } else {\n        audio.pause();\n      }\n    });\n    this.drawTime(0);\n    recordRow.appendChild(timer);\n\n    const saveBtn = this.saveBtn = document.createElement(\"button\");\n    saveBtn.className = \"vmsg-button vmsg-save-button\";\n    saveBtn.textContent = \"✓\";\n    saveBtn.title = \"Save Recording\";\n    saveBtn.disabled = true;\n    saveBtn.addEventListener(\"click\", () => this.close(this.recorder.blob));\n    recordRow.appendChild(saveBtn);\n\n    const gainWrapper = document.createElement(\"div\");\n    gainWrapper.className = \"vmsg-slider-wrapper vmsg-gain-slider-wrapper\";\n    const gainSlider = document.createElement(\"input\");\n    gainSlider.className = \"vmsg-slider vmsg-gain-slider\";\n    gainSlider.setAttribute(\"type\", \"range\");\n    gainSlider.min = 0;\n    gainSlider.max = 2;\n    gainSlider.step = 0.2;\n    gainSlider.value = 1;\n    gainSlider.onchange = () => {\n      const gain = +gainSlider.value;\n      this.recorder.gainNode.gain.value = gain;\n    };\n    gainWrapper.appendChild(gainSlider);\n    this.popup.appendChild(gainWrapper);\n\n    const pitchWrapper = document.createElement(\"div\");\n    pitchWrapper.className = \"vmsg-slider-wrapper vmsg-pitch-slider-wrapper\";\n    const pitchSlider = document.createElement(\"input\");\n    pitchSlider.className = \"vmsg-slider vmsg-pitch-slider\";\n    pitchSlider.setAttribute(\"type\", \"range\");\n    pitchSlider.min = -1;\n    pitchSlider.max = 1;\n    pitchSlider.step = 0.2;\n    pitchSlider.value = this.recorder.pitch;\n    pitchSlider.onchange = () => {\n      const pitch = +pitchSlider.value;\n      this.recorder.pitchFX.setPitchOffset(pitch);\n      this.recorder.gainNode.disconnect();\n      this.recorder.gainNode.connect(\n        pitch === 0 ? this.recorder.encNode : this.recorder.pitchFX.input\n      );\n    };\n    pitchWrapper.appendChild(pitchSlider);\n    this.popup.appendChild(pitchWrapper);\n    recordBtn.focus();\n  }\n\n  drawError(err) {\n    console.error(err);\n    this.drawInit();\n    this.clearAll();\n    const error = document.createElement(\"div\");\n    error.className = \"vmsg-error\";\n    error.textContent = err.toString();\n    this.popup.appendChild(error);\n  }\n\n  clearAll() {\n    if (!this.popup) return;\n    this.popup.innerHTML = \"\";\n  }\n\n  close(blob) {\n    if (this.audio) this.audio.pause();\n    if (this.tid) clearTimeout(this.tid);\n    this.recorder.close();\n    this.backdrop.remove();\n    if (blob) {\n      this.resolve(blob);\n    } else {\n      this.reject(new Error(\"No record made\"));\n    }\n  }\n\n  onStop() {\n    this.recordBtn.style.display = \"\";\n    this.stopBtn.style.display = \"none\";\n    this.stopBtn.disabled = false;\n    this.saveBtn.disabled = false;\n  }\n\n  startRecording() {\n    this.audio.pause();\n    this.start = Date.now();\n    this.updateTime();\n    this.recordBtn.style.display = \"none\";\n    this.stopBtn.style.display = \"\";\n    this.saveBtn.disabled = true;\n    this.stopBtn.focus();\n    this.recorder.startRecording();\n  }\n\n  stopRecording() {\n    clearTimeout(this.tid);\n    this.tid = 0;\n    this.stopBtn.disabled = true;\n    this.recordBtn.focus();\n    this.recorder.stopRecording();\n  }\n\n  updateTime() {\n    // NOTE(Kagami): We can do this in `onaudioprocess` but that would\n    // run too often and create unnecessary DOM updates.\n    this.drawTime(Date.now() - this.start);\n    this.tid = setTimeout(() => this.updateTime(), 300);\n  }\n}\n\nlet shown = false;\n\n/**\n * Record a new voice message.\n *\n * @param {Object=} opts - Options\n * @param {string=} opts.wasmURL - URL of the module\n *                                 (\"/static/js/vmsg.wasm\" by default)\n * @param {string=} opts.shimURL - URL of the WebAssembly polyfill\n *                                 (\"/static/js/wasm-polyfill.js\" by default)\n * @param {number=} opts.pitch - Initial pitch shift ([-1, 1], 0 by default)\n * @return {Promise.<Blob>} A promise that contains recorded blob when fulfilled.\n */\nfunction record(opts) {\n  return new Promise((resolve, reject) => {\n    if (shown) throw new Error(\"Record form is already opened\");\n    shown = true;\n    new Form(opts, resolve, reject);\n  // Use `.finally` once it's available in Safari and Edge.\n  }).then(result => {\n    shown = false;\n    return result;\n  }, err => {\n    shown = false;\n    throw err;\n  });\n}\n\n// Legacy API removed - Recorder, Form, and record() are now internal only\n// Use MultiRecorder from multi-recorder.ts instead\n\n// Borrowed from and slightly modified:\n// https://github.com/cwilso/Audio-Input-Effects/blob/master/js/jungle.js\n\n// Copyright 2012, Google Inc.\n// All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//     * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//     * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//     * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nconst delayTime = 0.100;\nconst fadeTime = 0.050;\nconst bufferTime = 0.100;\n\nfunction createFadeBuffer(context, activeTime, fadeTime) {\n  var length1 = activeTime * context.sampleRate;\n  var length2 = (activeTime - 2*fadeTime) * context.sampleRate;\n  var length = length1 + length2;\n  var buffer = context.createBuffer(1, length, context.sampleRate);\n  var p = buffer.getChannelData(0);\n\n  var fadeLength = fadeTime * context.sampleRate;\n\n  var fadeIndex1 = fadeLength;\n  var fadeIndex2 = length1 - fadeLength;\n\n  // 1st part of cycle\n  for (var i = 0; i < length1; ++i) {\n    var value;\n\n    if (i < fadeIndex1) {\n        value = Math.sqrt(i / fadeLength);\n    } else if (i >= fadeIndex2) {\n        value = Math.sqrt(1 - (i - fadeIndex2) / fadeLength);\n    } else {\n        value = 1;\n    }\n\n    p[i] = value;\n  }\n\n  // 2nd part\n  for (var i = length1; i < length; ++i) {\n    p[i] = 0;\n  }\n\n  return buffer;\n}\n\nfunction createDelayTimeBuffer(context, activeTime, fadeTime, shiftUp) {\n  var length1 = activeTime * context.sampleRate;\n  var length2 = (activeTime - 2*fadeTime) * context.sampleRate;\n  var length = length1 + length2;\n  var buffer = context.createBuffer(1, length, context.sampleRate);\n  var p = buffer.getChannelData(0);\n\n  // 1st part of cycle\n  for (var i = 0; i < length1; ++i) {\n    if (shiftUp)\n      // This line does shift-up transpose\n      p[i] = (length1-i)/length;\n    else\n      // This line does shift-down transpose\n      p[i] = i / length1;\n  }\n\n  // 2nd part\n  for (var i = length1; i < length; ++i) {\n    p[i] = 0;\n  }\n\n  return buffer;\n}\n\nfunction Jungle(context) {\n  this.context = context;\n  // Create nodes for the input and output of this \"module\".\n  var input = (context.createGain || context.createGainNode).call(context);\n  var output = (context.createGain || context.createGainNode).call(context);\n  this.input = input;\n  this.output = output;\n\n  // Delay modulation.\n  var mod1 = context.createBufferSource();\n  var mod2 = context.createBufferSource();\n  var mod3 = context.createBufferSource();\n  var mod4 = context.createBufferSource();\n  this.shiftDownBuffer = createDelayTimeBuffer(context, bufferTime, fadeTime, false);\n  this.shiftUpBuffer = createDelayTimeBuffer(context, bufferTime, fadeTime, true);\n  mod1.buffer = this.shiftDownBuffer;\n  mod2.buffer = this.shiftDownBuffer;\n  mod3.buffer = this.shiftUpBuffer;\n  mod4.buffer = this.shiftUpBuffer;\n  mod1.loop = true;\n  mod2.loop = true;\n  mod3.loop = true;\n  mod4.loop = true;\n\n  // for switching between oct-up and oct-down\n  var mod1Gain = (context.createGain || context.createGainNode).call(context);\n  var mod2Gain = (context.createGain || context.createGainNode).call(context);\n  var mod3Gain = (context.createGain || context.createGainNode).call(context);\n  mod3Gain.gain.value = 0;\n  var mod4Gain = (context.createGain || context.createGainNode).call(context);\n  mod4Gain.gain.value = 0;\n\n  mod1.connect(mod1Gain);\n  mod2.connect(mod2Gain);\n  mod3.connect(mod3Gain);\n  mod4.connect(mod4Gain);\n\n  // Delay amount for changing pitch.\n  var modGain1 = (context.createGain || context.createGainNode).call(context);\n  var modGain2 = (context.createGain || context.createGainNode).call(context);\n\n  var delay1 = (context.createDelay || context.createDelayNode).call(context);\n  var delay2 = (context.createDelay || context.createDelayNode).call(context);\n  mod1Gain.connect(modGain1);\n  mod2Gain.connect(modGain2);\n  mod3Gain.connect(modGain1);\n  mod4Gain.connect(modGain2);\n  modGain1.connect(delay1.delayTime);\n  modGain2.connect(delay2.delayTime);\n\n  // Crossfading.\n  var fade1 = context.createBufferSource();\n  var fade2 = context.createBufferSource();\n  var fadeBuffer = createFadeBuffer(context, bufferTime, fadeTime);\n  fade1.buffer = fadeBuffer\n  fade2.buffer = fadeBuffer;\n  fade1.loop = true;\n  fade2.loop = true;\n\n  var mix1 = (context.createGain || context.createGainNode).call(context);\n  var mix2 = (context.createGain || context.createGainNode).call(context);\n  mix1.gain.value = 0;\n  mix2.gain.value = 0;\n\n  fade1.connect(mix1.gain);\n  fade2.connect(mix2.gain);\n\n  // Connect processing graph.\n  input.connect(delay1);\n  input.connect(delay2);\n  delay1.connect(mix1);\n  delay2.connect(mix2);\n  mix1.connect(output);\n  mix2.connect(output);\n\n  // Start\n  var t = context.currentTime + 0.050;\n  var t2 = t + bufferTime - fadeTime;\n  mod1.start(t);\n  mod2.start(t2);\n  mod3.start(t);\n  mod4.start(t2);\n  fade1.start(t);\n  fade2.start(t2);\n\n  this.mod1 = mod1;\n  this.mod2 = mod2;\n  this.mod1Gain = mod1Gain;\n  this.mod2Gain = mod2Gain;\n  this.mod3Gain = mod3Gain;\n  this.mod4Gain = mod4Gain;\n  this.modGain1 = modGain1;\n  this.modGain2 = modGain2;\n  this.fade1 = fade1;\n  this.fade2 = fade2;\n  this.mix1 = mix1;\n  this.mix2 = mix2;\n  this.delay1 = delay1;\n  this.delay2 = delay2;\n\n  this.setDelay(delayTime);\n}\n\nJungle.prototype.setDelay = function(delayTime) {\n  this.modGain1.gain.setTargetAtTime(0.5*delayTime, 0, 0.010);\n  this.modGain2.gain.setTargetAtTime(0.5*delayTime, 0, 0.010);\n};\n\nJungle.prototype.setPitchOffset = function(mult) {\n  if (mult>0) { // pitch up\n    this.mod1Gain.gain.value = 0;\n    this.mod2Gain.gain.value = 0;\n    this.mod3Gain.gain.value = 1;\n    this.mod4Gain.gain.value = 1;\n  } else { // pitch down\n    this.mod1Gain.gain.value = 1;\n    this.mod2Gain.gain.value = 1;\n    this.mod3Gain.gain.value = 0;\n    this.mod4Gain.gain.value = 0;\n  }\n  this.setDelay(delayTime*Math.abs(mult));\n};\n","import { PCM_WORKLET_URL } from \"./assets\";\nimport { Recorder } from \"./vmsg\";\n\nexport type AudioFormat = \"mp3\" | \"wav\";\n\nexport interface MultiRecorderOptions {\n  format: AudioFormat;\n  sampleRate?: number;\n  wasmURL?: string;\n  shimURL?: string;\n  pitch?: number;\n  workletURL?: string;\n}\n\nfunction writeString(view: DataView, offset: number, string: string) {\n  for (let i = 0; i < string.length; i++) {\n    view.setUint8(offset + i, string.charCodeAt(i));\n  }\n}\n\nfunction floatTo16BitPCM(view: DataView, offset: number, input: Float32Array) {\n  for (let i = 0; i < input.length; i++, offset += 2) {\n    const s = Math.max(-1, Math.min(1, input[i]));\n    view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n  }\n}\n\nfunction mergeFloat32Arrays(arrays: Float32Array[]): Float32Array {\n  const totalLength = arrays.reduce((sum, arr) => sum + arr.length, 0);\n  const result = new Float32Array(totalLength);\n  let offset = 0;\n  for (const arr of arrays) {\n    result.set(arr, offset);\n    offset += arr.length;\n  }\n  return result;\n}\n\nfunction encodeWav(samples: Float32Array, sampleRate: number): Blob {\n  const buffer = new ArrayBuffer(44 + samples.length * 2);\n  const view = new DataView(buffer);\n\n  // RIFF header\n  writeString(view, 0, \"RIFF\");\n  view.setUint32(4, 36 + samples.length * 2, true);\n  writeString(view, 8, \"WAVE\");\n\n  // fmt chunk\n  writeString(view, 12, \"fmt \");\n  view.setUint32(16, 16, true); // chunk size\n  view.setUint16(20, 1, true); // audio format (PCM)\n  view.setUint16(22, 1, true); // num channels (mono)\n  view.setUint32(24, sampleRate, true); // sample rate\n  view.setUint32(28, sampleRate * 2, true); // byte rate\n  view.setUint16(32, 2, true); // block align\n  view.setUint16(34, 16, true); // bits per sample\n\n  // data chunk\n  writeString(view, 36, \"data\");\n  view.setUint32(40, samples.length * 2, true); // data size\n  floatTo16BitPCM(view, 44, samples);\n\n  return new Blob([view], { type: \"audio/wav\" });\n}\n\nexport class MultiRecorder {\n  private format: AudioFormat;\n  private sampleRate: number;\n  private wasmURL?: string;\n  private shimURL?: string;\n  private pitch?: number;\n\n  // MP3 recorder (vmsg)\n  private mp3Recorder: Recorder | null = null;\n\n  // WAV recorder\n  private wavStream: MediaStream | null = null;\n  private wavAudioCtx: AudioContext | null = null;\n  private wavProcessor: AudioWorkletNode | null = null;\n  private wavPcmData: Float32Array[] = [];\n  private workletURL?: string;\n\n  constructor(options: MultiRecorderOptions) {\n    this.format = options.format;\n    this.sampleRate = options.sampleRate || 48000;\n    this.wasmURL = options.wasmURL;\n    this.shimURL = options.shimURL;\n    this.pitch = options.pitch || 0;\n    this.workletURL = options.workletURL;\n  }\n\n  async init(): Promise<void> {\n    if (this.format === \"mp3\") {\n      this.mp3Recorder = new Recorder({\n        wasmURL: this.wasmURL || \"/static/js/vmsg.wasm\",\n        shimURL: this.shimURL,\n        pitch: this.pitch,\n      });\n      // MP3 recorder needs initAudio() and initWorker() which are called in init()\n      await this.mp3Recorder.init();\n    } else if (this.format === \"wav\") {\n      // WAV needs worklet to be loaded\n      this.wavPcmData = [];\n      // Worklet will be loaded when AudioContext is created in startRecording\n    }\n  }\n\n  async startRecording(): Promise<void> {\n    if (this.format === \"mp3\") {\n      if (!this.mp3Recorder) {\n        throw new Error(\"MP3 recorder not initialized. Call init() first.\");\n      }\n      // MP3 recorder already has the stream from initAudio() in init()\n      this.mp3Recorder.startRecording();\n    } else if (this.format === \"wav\") {\n      // WAV needs to get the stream\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      this.wavStream = stream;\n      const audioCtx = new AudioContext({ sampleRate: this.sampleRate });\n      this.wavAudioCtx = audioCtx;\n\n      // Load worklet module\n      const workletUrl = this.workletURL || PCM_WORKLET_URL;\n      await audioCtx.audioWorklet.addModule(workletUrl);\n\n      const source = audioCtx.createMediaStreamSource(stream);\n      const processor = new AudioWorkletNode(audioCtx, \"pcm-processor\");\n\n      // Listen to messages from worklet\n      processor.port.onmessage = (e) => {\n        const channelData = e.data as Float32Array;\n        if (channelData && channelData.length > 0) {\n          this.wavPcmData.push(new Float32Array(channelData));\n        }\n      };\n\n      source.connect(processor);\n      processor.connect(audioCtx.destination);\n      this.wavProcessor = processor;\n    }\n  }\n\n  async stopRecording(): Promise<Blob> {\n    if (this.format === \"mp3\") {\n      if (!this.mp3Recorder) {\n        throw new Error(\"MP3 recorder not initialized.\");\n      }\n      const blob = (await this.mp3Recorder.stopRecording()) as Blob;\n      this.mp3Recorder.close();\n      this.mp3Recorder = null;\n      return blob;\n    } else if (this.format === \"wav\") {\n      if (!this.wavProcessor || !this.wavAudioCtx || !this.wavStream) {\n        throw new Error(\"WAV recorder not initialized.\");\n      }\n\n      // Stop processing first\n      if (this.wavProcessor) {\n        this.wavProcessor.disconnect();\n      }\n\n      // Stop tracks\n      if (this.wavStream && this.wavStream.getTracks) {\n        this.wavStream.getTracks().forEach((track) => track.stop());\n      }\n\n      // Encode WAV from collected data\n      const mergedSamples = mergeFloat32Arrays(this.wavPcmData);\n      const blob = encodeWav(mergedSamples, this.sampleRate);\n\n      // Clear data but keep references for close() to handle cleanup\n      this.wavPcmData = [];\n\n      return blob;\n    }\n\n    throw new Error(`Unknown format: ${this.format}`);\n  }\n\n  close(): void {\n    if (this.format === \"mp3\" && this.mp3Recorder) {\n      this.mp3Recorder.close();\n      this.mp3Recorder = null;\n    } else if (this.format === \"wav\") {\n      // Disconnect processor first\n      if (this.wavProcessor) {\n        try {\n          this.wavProcessor.port.close();\n          this.wavProcessor.disconnect();\n        } catch (e) {\n          // Ignore errors if already disconnected\n        }\n        this.wavProcessor = null;\n      }\n\n      // Stop tracks\n      if (this.wavStream && this.wavStream.getTracks) {\n        this.wavStream.getTracks().forEach((track) => track.stop());\n        this.wavStream = null;\n      }\n\n      // Close AudioContext last, check state first\n      if (this.wavAudioCtx && this.wavAudioCtx.state !== \"closed\") {\n        this.wavAudioCtx.close().catch(() => {\n          // Ignore errors when closing\n        });\n      }\n      this.wavAudioCtx = null;\n\n      // Clear data\n      this.wavPcmData = [];\n    }\n  }\n}\n"]}